# 🚀 autoweKPI - 智能经营分析周报生成系统

[![Python Version](https://img.shields.io/badge/python-3.8+-blue.svg)](https://python.org)
[![Flask Version](https://img.shields.io/badge/flask-3.1+-green.svg)](https://flask.palletsprojects.com)
[![License](https://img.shields.io/badge/license-MIT-blue.svg)](LICENSE)

> 🎯 **一键生成专业经营分析报告** | 基于 Web 的智能数据分析平台

autoweKPI 是一个开源的智能化经营分析报告生成系统，专为保险、金融等需要定期经营分析的行业设计。只需上传 CSV 数据文件，系统即可自动生成包含多维度分析、交互式图表和异常监测的专业报告。

## ✨ 核心特性

- 🔄 **一键操作** - 上传 CSV，自动生成完整报告
- 📊 **多维度分析** - 机构、渠道、险种全方位分析
- 🎯 **智能识别** - 自动识别数据中的关键信息
- ⚠️ **异常监测** - 内置阈值检测，及时发现问题
- 📈 **交互式图表** - 基于 ECharts 的动态可视化
- 🌐 **Web 界面** - 无需安装，浏览器即可使用
- 📱 **响应式设计** - 支持桌面和移动设备

## 🎬 快速体验

### 🌐 在线演示

> 暂未部署在线演示，请按照以下步骤本地体验

### 📺 效果预览

![报告预览](tmp_overview_business.png)

## 🛠️ 安装指南

### 方法一：Git 克隆（推荐）

```bash
# 1. 克隆项目
git clone https://github.com/your-username/autoweKPI.git
cd autoweKPI

# 2. 创建虚拟环境
python -m venv venv

# 3. 激活虚拟环境
# Windows 用户：
venv\Scripts\activate
# macOS/Linux 用户：
source venv/bin/activate

# 4. 安装依赖
pip install -r requirements.txt

# 5. 启动系统
python app.py
```

### 方法二：直接下载

1. 访问 [GitHub Releases](https://github.com/your-username/autoweKPI/releases)
2. 下载最新版本的压缩包
3. 解压到任意目录
4. 按照方法一的步骤 2-5 操作

## 🚀 启动使用

### 第一步：启动系统

```bash
# 确保虚拟环境已激活
python app.py
```

看到以下信息表示启动成功：

```
启动 Web 服务: http://localhost:5001
 * Running on http://127.0.0.1:5001
```

### 第二步：访问系统

在浏览器中打开：**http://localhost:5001**

### 第三步：上传数据

1. 📁 准备符合格式的 CSV 文件（详见[数据格式要求](#数据格式要求)）
2. 📤 在网页中点击上传区域或拖拽文件
3. ⏳ 等待系统自动处理（通常 10-30 秒）
4. 📊 查看生成的专业报告

## 📋 数据格式要求

### 必需字段

您的 CSV 文件必须包含以下列（列名必须完全一致）：

| 列名                            | 中文名称   | 数据类型 | 示例         | 说明 |
| ------------------------------- | ---------- | -------- | ------------ | ---- |
| `third_level_organization`     | 三级机构   | 文本     | "天府"       | 具体分支机构名称 |
| `business_type_category`       | 业务类型分类 | 文本     | "非营业客车新车" | 车险业务类型 |
| `customer_category_3`          | 客户类别   | 文本     | "个人代理"   | 销售渠道分类 |
| `signed_premium_yuan`         | 签单保费   | 数值     | 15000.00     | 签单保费收入 |
| `matured_premium_yuan`        | 满期保费   | 数值     | 12000.00     | 满期保费收入 |
| `policy_count`                 | 保单件数   | 整数     | 25           | 保单数量 |
| `claim_case_count`             | 赔案件数   | 整数     | 3            | 赔案数量 |
| `reported_claim_payment_yuan` | 已报告赔款 | 数值     | 3000.00      | 已报告赔款金额 |
| `expense_amount_yuan`         | 费用额     | 数值     | 2000.00      | 费用支出 |
| `premium_plan_yuan`           | 预算保费   | 数值     | 18000.00     | 计划/预算保费 |
| `week_number`                 | 周数       | 整数     | 49           | 所属周数 |

### CSV 文件示例

```csv
third_level_organization,business_type_category,customer_category_3,signed_premium_yuan,matured_premium_yuan,policy_count,claim_case_count,reported_claim_payment_yuan,expense_amount_yuan,premium_plan_yuan,week_number
天府,非营业客车新车,个人代理,15000.00,12000.00,25,3,3000.00,2000.00,18000.00,49
武侯,营业货车-2-9吨,专业代理,25000.00,20000.00,40,5,5000.00,3500.00,28000.00,49
高新,非营业客车旧车,直营,18000.00,15000.00,30,2,2800.00,2200.00,20000.00,49
```

### 数据要求

- ✅ **文件格式**：CSV（逗号分隔）
- ✅ **文件大小**：建议不超过 50MB
- ✅ **编码格式**：UTF-8
- ✅ **数值格式**：使用数字格式，不含货币符号
- ✅ **文本格式**：机构名称保持一致

## 📊 功能详解

### 🔍 多维度分析

#### 1. 机构维度

- 📈 各分公司保费收入排名
- 💰 成本率对比分析
- 📊 赔付率监控
- 🎯 费用率控制效果

#### 2. 渠道维度

- 🏪 不同销售渠道业绩
- ⚡ 渠道效率评估
- 💸 渠道成本分析
- 📋 渠道贡献度排名

#### 3. 险种维度

- 🛡️ 各险种保费结构
- 💎 险种盈利能力
- ⚠️ 风险评估分析
- 📈 增长趋势追踪

### 🚨 智能异常监测

系统会自动检测并标记：

- 🔴 **严重异常**：变动成本率超过 93%、费用率超过 18%
- 🟡 **警告提醒**：年保费未达标（低于 95%）、满期赔付率超标（超过 72%）
- 📊 **四象限分析**：基于保费达成率、变动成本率、满期赔付率、费用率等基准线
- 📈 **基准对比**：保费达成率基准 100%、变动成本率基准 88%

### 📈 交互式图表

- 📊 **动态图表**：支持缩放、筛选、导出
- 🎨 **多种图表**：柱状图、饼图、折线图、表格
- 📱 **响应式**：自适应不同屏幕尺寸
- 🔄 **实时更新**：数据变化即时反映

## 🎯 使用场景

### 适用行业

- 🏢 **保险行业**：车险、寿险、财险经营分析
- 🏦 **金融行业**：银行、证券、基金业绩分析
- 🛒 **零售行业**：连锁店、电商平台销售分析
- 🏭 **制造业**：多工厂、多产品线经营分析

### 典型用户

- 👨‍💼 **经营分析师**：定期生成经营报告
- 📊 **数据分析师**：深度数据挖掘分析
- 👔 **企业管理者**：快速了解经营状况
- 🏢 **分公司经理**：监控本机构业绩

## 🔧 高级配置

### 自定义配置

您可以通过修改配置文件来自定义系统行为：

#### 1. 业务类型映射 (`reference/business_type_mapping.json`)

系统已预配置16种车险业务类型映射，包括：

**主要业务类型分类：**
- 🚗 **非营业客车**：新车、旧车非过户、旧车过户
- 🚚 **非营业货车**：1吨以下、1-2吨
- 🚛 **营业货车**：2吨以下、2-9吨、9-10吨、10吨以上（普货/牵引/自卸/特种）、其他
- 🚕 **营业客车**：出租车、网约车
- 🏍️ **其他**：摩托车

**配置示例：**
```json
{
  "business_types": [
    {
      "ui_full_name": "非营业客车新车",
      "ui_short_label": "非营客-新",
      "csv_raw_value": "非营业客车新车",
      "category": "非营业客车"
    }
  ]
}
```

#### 2. 阈值设置 (`reference/thresholds.json`)

系统配置了四象限基准线和问题机构识别阈值：

```json
{
  "四象限基准线": {
    "保费达成率": 100,
    "变动成本率": 88,
    "满期赔付率": 70,
    "费用率": 14,
    "出险率": 11.5,
    "案均赔款": 4800
  },
  "问题机构识别阈值": {
    "年保费未达标": 95,
    "变动成本率超标": 93,
    "满期赔付率超标": 72,
    "费用率超标": 18
  }
}
```

#### 3. 年度计划 (`reference/year-plans.json`)

配置各分支机构的年度保费计划目标：

```json
{
  "年度保费计划": {
    "四川分公司": 431000000,
    "天府": 197300000,
    "武侯": 13500000,
    "高新": 55700000,
    "青羊": 43400000,
    "新都": 35000000,
    "德阳": 12800000,
    "宜宾": 22700000,
    "泸州": 10750000,
    "乐山": 11900000,
    "自贡": 9450000,
    "资阳": 12000000,
    "达州": 6500000,
    "本部": 1000000
  }
}
```

### 命令行使用

除了 Web 界面，您也可以使用命令行：

```bash
# 基本用法
python main.py --csv your_data.csv

# 完整参数
python main.py \
  --csv data/your_data.csv \
  --template templates/report_template.html \
  --output output/my_report.html \
  --week 49 \
  --org "四川分公司" \
  --year 2025
```

## 📁 项目结构

```
autoweKPI/
├── 📁 src/                    # 核心代码
│   ├── data_loader.py         # 数据加载
│   ├── kpi_calculator.py      # 指标计算
│   ├── mapper.py              # 数据映射
│   └── report_generator.py    # 报告生成
├── 📁 templates/              # HTML 模板
├── 📁 reference/              # 配置文件
├── 📁 docs/                   # 详细文档
├── 📁 tests/                  # 测试文件
├── 📁 asset/                  # 静态资源
├── app.py                    # Web 应用
├── main.py                   # 命令行工具
├── requirements.txt          # 依赖列表
└── README.md                 # 项目说明
```

## 🔧 故障排除

### 常见问题

#### ❌ 问题 1：端口被占用

**错误信息**：`Address already in use`

**解决方案**：

```bash
# 方法 1：使用不同端口
python app.py  # 默认 5001，可修改 app.py 中的端口号

# 方法 2：结束占用进程
# Windows:
netstat -ano | findstr :5001
taskkill /PID <进程ID> /F

# macOS/Linux:
lsof -i :5001
kill -9 <进程ID>
```

#### ❌ 问题 2：依赖安装失败

**错误信息**：`pip install failed`

**解决方案**：

```bash
# 升级 pip
python -m pip install --upgrade pip

# 使用国内镜像源
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple/

# 单独安装依赖
pip install flask pandas numpy
```

#### ❌ 问题 3：文件上传失败

**可能原因**：

- 文件格式不是 CSV
- 文件大小超过限制
- 缺少必需字段

**解决方案**：

1. 检查文件格式：确保是 CSV 格式
2. 检查文件大小：建议小于 50MB
3. 检查字段名称：确保包含所有必需字段
4. 检查数据格式：数值字段应为数字格式

#### ❌ 问题 4：报告生成失败

**排查步骤**：

1. 检查控制台错误信息
2. 验证数据格式是否正确
3. 确认所有必需字段都有数据
4. 检查是否有异常值（如负数的保费）

### 获取帮助

如果遇到问题，可以通过以下方式获取帮助：

1. 📖 **查看文档**：阅读 `docs/` 目录下的详细文档
2. 🔍 **搜索 Issues**：在 GitHub Issues 中搜索类似问题
3. 🐛 **提交 Issue**：详细描述问题并提供错误信息
4. 💬 **社区讨论**：参与 GitHub Discussions 讨论

## 🤝 贡献指南

我们欢迎所有形式的贡献！

### 如何贡献

1. 🍴 **Fork 项目**：点击右上角 Fork 按钮
2. 🌿 **创建分支**：`git checkout -b feature/amazing-feature`
3. 💾 **提交更改**：`git commit -m 'Add amazing feature'`
4. 📤 **推送分支**：`git push origin feature/amazing-feature`
5. 🔀 **创建 Pull Request**：在 GitHub 上创建 PR

### 贡献类型

- 🐛 **Bug 修复**：修复已知问题
- ✨ **新功能**：添加新的功能特性
- 📚 **文档改进**：完善文档和说明
- 🎨 **界面优化**：改进用户界面
- ⚡ **性能优化**：提升系统性能

### 开发规范

- 📝 **代码风格**：遵循 PEP 8 规范
- 🧪 **测试覆盖**：为新功能添加测试
- 📖 **文档更新**：及时更新相关文档
- 💬 **提交信息**：使用清晰的提交信息

## 📄 开源协议

本项目采用 [MIT License](LICENSE) 开源协议。

## 🙏 致谢

感谢以下开源项目的支持：

- [Flask](https://flask.palletsprojects.com) - Web 框架
- [Pandas](https://pandas.pydata.org) - 数据处理
- [ECharts](https://echarts.apache.org) - 数据可视化
- [NumPy](https://numpy.org) - 数值计算

## 📞 联系我们

- 📧 **邮箱**：your-email@example.com
- 🐙 **GitHub**：https://github.com/your-username/autoweKPI
- 📖 **文档**：https://your-username.github.io/autoweKPI
- 💬 **讨论**：https://github.com/your-username/autoweKPI/discussions

---

## 🌟 Star History

如果这个项目对您有帮助，请给我们一个 ⭐️！

[![Star History Chart](https://api.star-history.com/svg?repos=your-username/autoweKPI&type=Date)](https://star-history.com/#your-username/autoweKPI&Date)

---

<div align="center">

**🚀 立即开始使用 autoweKPI，让数据分析变得简单高效！**

[📖 快速开始](#-快速开始) • [🎬 在线演示](#-在线演示) • [📖 详细文档](docs/) • [🤝 贡献代码](#-贡献指南)

</div>
